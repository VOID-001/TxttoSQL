from fastapi import APIRouter, HTTPException
from utils.schema_extractor import get_schema_info

schema_router = APIRouter()


@schema_router.get("/get-schema/")
async def get_schema():
    """Fetch and return the current PostgreSQL schema."""
    try:
        schema_info = get_schema_info()  # Fetch schema information
        if not schema_info:
            raise HTTPException(status_code=404, detail="No schema information found.")

        # Return the schema info as a list of tables and columns
        return {"schema": schema_info}

    except Exception as e:
        raise HTTPException(status_code=500, detail=f"Error fetching schema: {str(e)}")
